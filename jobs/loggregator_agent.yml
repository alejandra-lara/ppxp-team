name: loggregator_agent
release: loggregator-agent
consumes: |
  doppler: {from: doppler, deployment: (( ..cf.deployment_name )) }
manifest: |
  metrics:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_agent_metrics_tls.cert_pem ))
    key: (( .properties.loggregator_agent_metrics_tls.private_key_pem ))
    server_name: loggregator_agent_metrics
  grpc_port: 3459
  disable_udp: true
  loggregator_agent:
    enabled: (( ..cf.properties.enable_v2_firehose.value ))
  loggregator:
    tls:
      ca_cert: (( $ops_manager.ca_certificate ))
      agent:
        cert: (( .properties.loggregator_agent_tls_cert.cert_pem ))
        key: (( .properties.loggregator_agent_tls_cert.private_key_pem ))
  tags: (( .properties.compute_isolation.selected_option.parsed_manifest(for_loggregator_agent_tags) ))
