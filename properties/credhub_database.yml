---
- name: credhub_database_name
  type: string
  configurable: false
  default: credhub

- name: credhub_database
  type: selector
  configurable: true
  default: internal_mysql
  option_templates:
    - name: internal_mysql
      select_value: internal_mysql
      named_manifests:
      - name: db_config
        manifest: |
          type: mysql
          host: mysql.service.cf.internal
          port: 3306
          username: ((( credhub-db-credentials.username )))
          password: ((( credhub-db-credentials.password )))
          database: (( .properties.credhub_database_name.value ))
          require_tls: (( .properties.system_database.selected_option.parsed_manifest(enable_pxc) ))
          tls_ca: (( $ops_manager.ca_certificate ))

    - name: external
      select_value: external
      property_blueprints:
        - name: host
          type: string
          configurable: true
        - name: port
          type: port
          configurable: true
        - name: username
          type: string
          configurable: true
        - name: password
          type: secret
          configurable: true
        - name: tls_ca
          type: text
          configurable: true
        - name: require_tls
          type: boolean
      named_manifests:
      - name: db_config
        manifest: |
          type: mysql
          host: (( .properties.credhub_database.external.host.value ))
          port: (( .properties.credhub_database.external.port.value ))
          username: (( .properties.credhub_database.external.username.value ))
          password: (( .properties.credhub_database.external.password.value ))
          database: (( .properties.credhub_database_name.value ))
          require_tls: true
          tls_ca: (( .properties.credhub_database.external.tls_ca.value ))
