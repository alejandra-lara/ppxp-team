---
name: mysql_config
label: Internal MySQL
description: |
  Only configure this section if you selected Internal Databases - MySQL
  in the previous Databases section.
markdown: |
  A proxy tier routes MySQL connections from internal components to healthy
  cluster nodes. Configure DNS and/or your own load balancer to point to
  multiple proxy instances for increased availability. TCP healthchecks can
  be configured against port 1936.

property_inputs:
  - reference: .mysql_proxy.static_ips
    label: MySQL Proxy IPs
    description: |
      Enter the IP address(es) for the MySQL proxy instances configured on
      your external load balancer.

  - reference: .mysql_proxy.service_hostname
    label: MySQL Service Hostname
    description: |
      To remove a MySQL proxy as a single point of failure, configure your
      load balancer to route application requests to multiple proxy
      instances. Then enter the IP or hostname of the load balancer here, so
      components reach their MySQL databases through the load balancer. If
      this field is blank, components use the IP of the first MySQL proxy
      instance.

  - reference: .mysql_monitor.poll_frequency
    label: Replication canary time period
    description: |
      How frequently the canary checks for replication failure, in seconds.
      Lower numbers will cause the canary to run more frequently, adding load
      to the database.

  - reference: .mysql_monitor.write_read_delay
    label: Replication canary read delay
    description: |
      How long the canary waits to verify data is replicating across each
      MySQL node, in seconds. Clusters under heavily load will experience
      some small replication lag as writesets are committed across the nodes.

  - reference: .mysql_monitor.recipient_email
    label: E-mail address (required)
    description: |
      The MySQL service will send alerts when the cluster experiences a
      replication issue or a node is not allowed to auto-rejoin the cluster.
    placeholder: Fill in your desired email address

  - reference: .mysql.cli_history
    label: Allow Command History
    description: |
      When disabled, prohibits the creation of command line history files on
      the MySQL nodes.

  - reference: .mysql.remote_admin_access
    label: Allow Remote Admin Access
    description: |
      When enabled, admin and roadmin will be able to connect from any remote host.

  - reference: .mysql.cluster_probe_timeout
    label: Cluster Probe Timeout
    description: |
      The maximum amount of time, in seconds, that a new node will search
      for existing cluster nodes. The default value is 10 seconds.

  - reference: .mysql.max_connections
    label: Max Connections
    description: |
      The maximum number of connections allowed to the database.

  - reference: .properties.mysql_activity_logging
    label: Server Activity Logging
    selector_property_inputs:
      - reference: .properties.mysql_activity_logging.disable
        label: Disable server activity logging
        description: Disable server activity logging

      - reference: .properties.mysql_activity_logging.enable
        label: Enable server activity logging
        description: Enable server activity logging
        property_inputs:
          - reference: .properties.mysql_activity_logging.enable.audit_logging_events
            label: Event types
            description: |
              The MySQL service will keep a record of server activity. The
              default setting tracks who connected to the system and what
              queries were processed. For more information, see:
              https://mariadb.com/kb/en/mariadb/about-the-mariadb-audit-plugin/

  - reference: .mysql_proxy.startup_delay
    label: Load Balancer Healthy Threshold
    description: |
      Specifies the amount of time, in seconds, to wait until declaring the
      Proxy instance started. This allows an external load balancer time to
      register the instance as healthy.

  - reference: .mysql_proxy.shutdown_delay
    label: Load Balancer Unhealthy Threshold
    description: |
      Specifies the amount of time, in seconds, that the MySQL Proxy will
      continue to accept connections before shutting down. During this
      period, the healthcheck will report unhealthy to cause load balancers
      to fail over to other Proxies. This value should be greater than or
      equal to the max time it could take your load balancer to consider a
      Proxy instance unhealthy, given contiguous failed healthchecks.

  - reference: .mysql.prevent_node_auto_rejoin
    label: Prevent node auto re-join
    description: |
      When checked, nodes unable to IST will be prevented from automatically
      deleting their data and performing an SST.
