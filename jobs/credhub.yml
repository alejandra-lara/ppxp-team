---
name: credhub
release: credhub
provides: |
  credhub: {shared: true}
manifest: |
  credhub:
    authentication:
      mutual_tls:
        trusted_cas:
        - ((( /cf/diego-instance-identity-root-ca.certificate )))
      uaa:
        ca_certs:
        - (( $ops_manager.ca_certificate ))
        url: https://uaa.service.cf.internal:8443
    authorization:
      acls:
        enabled: true
      permissions:
        - path: /credhub-clients/*
          actors: ["uaa-client:credhub-service-broker"]
          operations: ["read", "write", "delete", "read_acl", "write_acl"]
        - path: /credhub-service-broker/*
          actors: ["uaa-client:credhub-service-broker"]
          operations: ["read", "write", "delete", "read_acl", "write_acl"]
        - path: /c/*
          actors: ["uaa-client:services_credhub_client"]
          operations: ["read", "write", "delete", "read_acl", "write_acl"]
        - path: /*
          actors: ["uaa-client:cc_service_key_client"]
          operations: ["read"]
    ca_certificate: (( $ops_manager.ca_certificate ))
    data_storage: (( .properties.credhub_database.selected_option.parsed_manifest(db_config) ))
    encryption:
      keys: (( .properties.credhub_key_encryption_passwords.parsed_manifest(keys) ))
      providers: (( .properties.credhub_hsm_provider_list.selected_option.parsed_manifest(list) ))
    internal_url: credhub.service.cf.internal
    tls:
      certificate: (( .properties.credhub_tls.cert_pem ))
      private_key: (( .properties.credhub_tls.private_key_pem ))
