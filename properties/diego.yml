---
- name: nfs_volume_driver
  type: selector
  configurable: true
  default: enable
  option_templates:
    - name: enable
      select_value: enable
      named_manifests:
        - name: nfsv3driver_properties
          manifest: |
            "(( .properties.nfs_volume_driver.enable.ldap_server_host.value_present? ? .properties.nfs_volume_driver.selected_option.parsed_manifest(nfsv3driver_properties_ldap) : .properties.nfs_volume_driver.selected_option.parsed_manifest(nfsv3driver_properties_non_ldap) ))"

        - name: nfsv3driver_properties_ldap
          manifest: |
            disable: false
            ldap_svc_user: (( .properties.nfs_volume_driver.enable.ldap_service_account_user.value ))
            ldap_svc_password: (( .properties.nfs_volume_driver.enable.ldap_service_account_password.value ))
            ldap_host: (( .properties.nfs_volume_driver.enable.ldap_server_host.value ))
            ldap_port: (( .properties.nfs_volume_driver.enable.ldap_server_port.value ))
            ldap_user_fqdn: (( .properties.nfs_volume_driver.enable.ldap_user_fqdn.value ))
            ldap_ca_cert: (( .properties.nfs_volume_driver.enable.ldap_ca_cert.value ))
            allowed-in-source: ""

        - name: nfsv3driver_properties_non_ldap
          manifest: |
            disable: false
            ldap_svc_user: (( .properties.nfs_volume_driver.enable.ldap_service_account_user.value ))
            ldap_svc_password: (( .properties.nfs_volume_driver.enable.ldap_service_account_password.value ))
            ldap_host: (( .properties.nfs_volume_driver.enable.ldap_server_host.value ))
            ldap_port: (( .properties.nfs_volume_driver.enable.ldap_server_port.value ))
            ldap_user_fqdn: (( .properties.nfs_volume_driver.enable.ldap_user_fqdn.value ))
            ldap_ca_cert: (( .properties.nfs_volume_driver.enable.ldap_ca_cert.value ))

        - name: mapfs_properties
          manifest: |
            disable: false

      property_blueprints:
        - name: ldap_service_account_user
          type: string
          configurable: true
          optional: true

        - name: ldap_service_account_password
          type: secret
          configurable: true
          optional: true

        - name: ldap_server_host
          type: string
          configurable: true
          optional: true

        - name: ldap_server_port
          type: integer
          configurable: true
          optional: true

        - name: ldap_user_fqdn
          type: string
          configurable: true
          optional: true

        - name: ldap_ca_cert
          type: text
          configurable: true
          optional: true

    - name: disable
      select_value: disable
      named_manifests:
        - name: nfsv3driver_properties
          manifest: |
            disable: true

        - name: mapfs_properties
          manifest: |
            disable: true

- name: enable_smb_volume_driver
  type: boolean
  configurable: true
  default: true

- name: loggregator_client_cert
  type: rsa_cert_credentials
  configurable: false

- name: route_integrity
  type: selector
  configurable: true
  default: tls_verify
  option_templates:
    - name: tls_verify
      select_value: tls_verify
      named_manifests:
        - name: proxy
          manifest: |
            enabled: true
            additional_memory_allocation_mb: 32
    - name: mutual_tls_verify
      select_value: mutual_tls_verify
      named_manifests:
        - name: proxy
          manifest: |
            enabled: true
            additional_memory_allocation_mb: 32
            enable_unproxied_port_mappings: false
            require_and_verify_client_certificates: true
            trusted_ca_certificates:
            - (( $ops_manager.ca_certificate ))
            verify_subject_alt_name:
            - gorouter.service.cf.internal
            - ssh-proxy.service.cf.internal
