---
name: loggregator_trafficcontroller
release: loggregator
manifest: |
  traffic_controller:
    enabled: (( .properties.enable_v1_firehose.value ))
  system_domain: (( .cloud_controller.system_domain.value ))
  ssl:
    skip_cert_verify: (( .ha_proxy.skip_cert_verify.value ))
  cc:
    internal_service_hostname: cloud-controller-ng.service.cf.internal
    mutual_tls:
      ca_cert: (( $ops_manager.ca_certificate ))
    tls_port: 9023
  uaa:
    internal_url: "https://uaa.service.cf.internal:8443"
    ca_cert: (( $ops_manager.ca_certificate ))
  loggregator:
    tls:
      ca_cert: (( $ops_manager.ca_certificate ))
      cc_trafficcontroller:
        cert: (( .loggregator_trafficcontroller.cc_trafficcontroller_tls_cert.cert_pem ))
        key: (( .loggregator_trafficcontroller.cc_trafficcontroller_tls_cert.private_key_pem ))
      trafficcontroller:
        cert: (( .loggregator_trafficcontroller.trafficcontroller_tls_cert.cert_pem ))
        key: (( .loggregator_trafficcontroller.trafficcontroller_tls_cert.private_key_pem ))
    outgoing_cert: (( .properties.trafficcontroller_tls_cert.cert_pem ))
    outgoing_key: (( .properties.trafficcontroller_tls_cert.private_key_pem ))
    uaa:
      client: (( .uaa.doppler_client_credentials.identity ))
      client_secret: (( .uaa.doppler_client_credentials.password ))
