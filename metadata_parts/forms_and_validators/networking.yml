---
form:
  name: networking
  label: Networking
  description: |
    Configure security and routing services for your isolation segment.

  property_inputs:
  - reference: .isolated_diego_cell.garden_network_mtu
    label: |
      Applications Network Maximum Transmission Unit (MTU) (in bytes)
    description: |
      The default 1454 bytes is fine for most cases, but you might need less,
      such as for networks that use GRE tunnels.

  - reference: .isolated_router.static_ips
    label: Router IPs
    description: |
      If you are deploying onto an infrastructure that does not support
      automated assignment of routers to load balancers (vSphere), or you are
      intending to manually configure your load balancer with the IP
      addresses of the routers, you should enter static IP addresses here
      that will be used by the routers. On infrastructures where automated
      load balancer assignment is supported (AWS, GCP, Azure), this field can
      be left blank and the "Load Balancers" field on the "Resource Config"
      tab can be filled out with the correct load balancer assignment.

  - reference: .properties.networking_poe_ssl_cert
    label: Certificate and Private Key for Router
    description: |
      This certificate and key are used to terminate SSL traffic at the
      Router. The certificate can have multiple domains attributed
      to it, for example if you have separate system and application
      domains. You can also generate a self-signed certificate here
      with your wildcard system domain.

  - reference: .properties.routing_minimum_tls_version
    label: Minimum version of TLS supported by HAProxy and Router
    selector_property_inputs:
      - reference: .properties.routing_minimum_tls_version.tls_v1_0
        label: TLSv1.0
      - reference: .properties.routing_minimum_tls_version.tls_v1_1
        label: TLSv1.1
      - reference: .properties.routing_minimum_tls_version.tls_v1_2
        label: TLSv1.2

  - reference: .properties.haproxy_forward_tls
    label: |
      HAProxy forwards requests to Router over TLS. When enabled, HAProxy
      will forward all requests to the Router over TLS. HAProxy will use
      the CA provided  to verify the certificates provided by the Router.
    selector_property_inputs:
      - reference: .properties.haproxy_forward_tls.enable
        label: Enable
        property_inputs:
        - reference: .properties.haproxy_forward_tls.enable.backend_ca
          label: Certificate Authority for HAProxy Backend
          description: |
            You need to provide a certificate authority for the certificate
            and key provided in the "Certificate and Private Key for HAProxy
            and Router" field. HAProxy will verify those certificates using
            this CA when establishing a connection. If you generated that
            certificate and key using the "Generate RSA Certificate" feature,
            then your CA is the Ops Manager CA, and can be found by visiting
            the "/api/v0/certificate_authorities" API endpoint.
      - reference: .properties.haproxy_forward_tls.disable
        label: Disable

  - reference: .properties.gorouter_ssl_ciphers
    label: TLS Cipher Suites for Router
    description: |
      An ordered, colon-delimited list of Golang supported TLS cipher suites in
      OpenSSL format, e.g. "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384"
    placeholder: |
      ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384

  - reference: .properties.haproxy_ssl_ciphers
    label: TLS Cipher Suites for HAProxy
    description: |
      An ordered, colon-delimited list of TLS cipher suites in OpenSSL format,
      e.g. "ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384"
    placeholder: |
      DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384

  - reference: .properties.routing_disable_http
    label: Disable HTTP on HAProxy and Gorouter
    description: When checked, HAProxy and Gorouter will not listen on port 80.

  - reference: .isolated_ha_proxy.internal_only_domains
    label: Protected Domains
    description: |
      A comma-separated list of domains to protect from requests from
      unknown sources.  Use this property in conjunction with
      "Trusted CIDRs" to protect these domains from requests from
      unknown sources.

  - reference: .isolated_ha_proxy.trusted_domain_cidrs
    label: Trusted CIDRs
    description: |
      A space-separated list of CIDRs allowed to make requests
      to the domains listed in the "Protected Domains" field. For example,
      specifying 10.0.1.0/24 would allow any requests originating at a host IP
      in that range to reach applications or services hosted on the
      "Protected Domains" list.

  - reference: .properties.container_networking_vtep_port
    label: VXLAN Tunnel Endpoint Port
    description: |
      Host port used for receiving VXLAN packets. Defaults to 4789.

  - reference: .properties.routing_table_sharding_mode
    label: "Router Sharding Mode: When 'Isolation Segment Only' is selected, the routers of this tile will only have knowledge of applications deployed to the Cells of this tile; all other requests will receive a 404 response. When 'No Isolation Segments' is selected, the routers of this tile will reject requests for any isolation segment. Choose 'No Isolation Segments' to add a group of routers for the Elastic Runtime tile, as when a private point of entry for the system domain is desired."
    selector_property_inputs:
    - reference: .properties.routing_table_sharding_mode.isolation_segment_only
      label: Isolation Segment Only
    - reference: .properties.routing_table_sharding_mode.no_isolation_segment
      label: No Isolation Segment

  - reference: .properties.c2c_iptables_logging
    label: Log traffic for all accepted/denied application packets.
    selector_property_inputs:
      - reference: .properties.c2c_iptables_logging.enabled
        label: Enable (will increase log volume)
        property_inputs:
          - reference: .properties.c2c_iptables_logging.enabled.denied_logging_interval
            label: Denied logging interval (packets/second)
            description: |
               Denied traffic logging is rate limited. Override the
               default of 1 packet/second.

          - reference: .properties.c2c_iptables_logging.enabled.udp_logging_interval
            label: UDP logging interval (packets/second)
            description: |
              UDP traffic logging is rate limited. Override the
              default of 100 packets/second.

      - reference: .properties.c2c_iptables_logging.disabled
        label: Disable

  - reference: .properties.router_forward_client_cert
    label: |
      Configure the CF Router support for the X-Forwarded-Client-Cert header.
      Setting this field to an option other than "Always forward" will
      change the behavior for how the Router handles the
      x-forwarded-client-cert (XFCC) HTTP header. This header can be used
      by applications to verify the requester via mutual TLS.
    selector_property_inputs:
      - reference: .properties.router_forward_client_cert.always_forward
        label: Always forward the XFCC header in the request, regardless of whether the client connection is mTLS
      - reference: .properties.router_forward_client_cert.forward
        label: Forward the XFCC header received from the client only when the client connection is mTLS
      - reference: .properties.router_forward_client_cert.sanitize_set
        label: Strip the XFCC header when present and set it to the client certificate from the mTLS handshake

  - reference: .properties.router_backend_max_conn
    label: Max Connections Per Backend
    description: |
      Maximum concurrent TCP connections per backend for each instance of
      the Router. A value of 0 means unlimited.
