name: rep
release: diego
manifest: |
  containers:
    proxy:
      enabled: (( .properties.rep_proxy_enabled.value ))
    trusted_ca_certificates:
    - |
      ((( /cf/diego-instance-identity-root-ca.certificate )))
    - |
      (( $ops_manager.ca_certificate ))
    - |
      (( $ops_manager.trusted_certificates ))
  diego:
    executor:
      disk_capacity_mb: (( executor_disk_capacity.value ))
      memory_capacity_mb: (( executor_memory_capacity.value ))
      post_setup_hook: sh -c "rm -f /home/vcap/app/.java-buildpack.log /home/vcap/app/**/.java-buildpack.log"
      post_setup_user: "root"
      ca_certs_for_downloads: (( $ops_manager.ca_certificate ))
      instance_identity_ca_cert: ((( /cf/diego-instance-identity-intermediate-ca.certificate )))
      instance_identity_key: ((( /cf/diego-instance-identity-intermediate-ca.private_key )))
    rep:
      require_tls: true
      ca_cert: (( $ops_manager.ca_certificate ))
      server_cert: (( .properties.rep_server_cert.cert_pem ))
      server_key: (( .properties.rep_server_cert.private_key_pem ))
      use_azure_fault_domains: true
      preloaded_rootfses: '(( .properties.enable_grootfs.value ? .properties.rep_preloaded_rootfses_grootfs.value : .properties.rep_preloaded_rootfses_garden.value ))'
      placement_tags: [ (( placement_tag.value )) ]
      bbs:
        ca_cert: (( $ops_manager.ca_certificate ))
        client_cert: (( .properties.bbs_client_cert.cert_pem ))
        client_key: (( .properties.bbs_client_cert.private_key_pem ))
      locket:
        api_location: locket.service.cf.internal:8891
  enable_declarative_healthcheck: true
  loggregator:
    use_v2_api: true
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_client_cert.cert_pem ))
    key: (( .properties.loggregator_client_cert.private_key_pem ))
    tls:
      ca_cert: (( $ops_manager.ca_certificate ))
      metron:
        cert: (( .properties.metron_tls_cert.cert_pem ))
        key: (( .properties.metron_tls_cert.private_key_pem ))
  tls:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.rep_server_cert.cert_pem ))
    key: (( .properties.rep_server_cert.private_key_pem ))
