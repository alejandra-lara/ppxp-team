name: rep
release: diego
manifest: |
  bpm:
    enabled: true
  containers:
    proxy: (( .properties.route_integrity.selected_option.parsed_manifest(proxy) ))
    trusted_ca_certificates:
      - ((( /cf/diego-instance-identity-root-ca.certificate )))
      - (( $ops_manager.ca_certificate ))
      - (( $ops_manager.trusted_certificates ))
  diego:
    executor:
      disk_capacity_mb: (( executor_disk_capacity.value ))
      memory_capacity_mb: (( executor_memory_capacity.value ))
      post_setup_hook: sh -c "rm -f /home/vcap/app/.java-buildpack.log /home/vcap/app/**/.java-buildpack.log"
      post_setup_user: "root"
      instance_identity_ca_cert: ((( /cf/diego-instance-identity-intermediate-ca-2018.certificate )))
      instance_identity_key: ((( /cf/diego-instance-identity-intermediate-ca-2018.private_key )))
    rep:
      use_azure_fault_domains: true
      preloaded_rootfses:
        - "cflinuxfs2:/var/vcap/packages/cflinuxfs2/rootfs.tar"
        - "cflinuxfs3:/var/vcap/packages/cflinuxfs3/rootfs.tar"
      placement_tags: [ (( placement_tag.value )) ]
  enable_consul_service_registration: false
  enable_declarative_healthcheck: true
  logging:
    format:
      timestamp: (( ..cf.properties.diego_log_timestamp_format.selected_option.parsed_manifest(timestamp_format) ))
  loggregator:
    use_v2_api: true
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_client_cert.cert_pem ))
    key: (( .properties.loggregator_client_cert.private_key_pem ))
  tls:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.rep_server_cert_v2.cert_pem ))
    key: (( .properties.rep_server_cert_v2.private_key_pem ))
