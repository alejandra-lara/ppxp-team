---
name: system_blobstore
label: File Storage
description: |
  This section determines where you would like to place your Application Service
  Cloud Controller's file storage.

verifiers:
  - name: Verifiers::BlobstoreVerifier
    properties:
      endpoint: .properties.system_blobstore.external.endpoint
      access_key_id: .properties.system_blobstore.external.access_key
      secret_access_key: .properties.system_blobstore.external.secret_key
      bucket_name: .properties.system_blobstore.external.buildpacks_bucket
      region: .properties.system_blobstore.external.region
      signature_version: .properties.system_blobstore.external.signature_version

  - name: Verifiers::BlobstoreVerifier
    properties:
      endpoint: .properties.system_blobstore.external.endpoint
      access_key_id: .properties.system_blobstore.external.access_key
      secret_access_key: .properties.system_blobstore.external.secret_key
      bucket_name: .properties.system_blobstore.external.droplets_bucket
      region: .properties.system_blobstore.external.region
      signature_version: .properties.system_blobstore.external.signature_version

  - name: Verifiers::BlobstoreVerifier
    properties:
      endpoint: .properties.system_blobstore.external.endpoint
      access_key_id: .properties.system_blobstore.external.access_key
      secret_access_key: .properties.system_blobstore.external.secret_key
      bucket_name: .properties.system_blobstore.external.packages_bucket
      region: .properties.system_blobstore.external.region
      signature_version: .properties.system_blobstore.external.signature_version

  - name: Verifiers::BlobstoreVerifier
    properties:
      endpoint: .properties.system_blobstore.external.endpoint
      access_key_id: .properties.system_blobstore.external.access_key
      secret_access_key: .properties.system_blobstore.external.secret_key
      bucket_name: .properties.system_blobstore.external.resources_bucket
      region: .properties.system_blobstore.external.region
      signature_version: .properties.system_blobstore.external.signature_version

property_inputs:
- reference: .properties.system_blobstore
  label: Configure your Cloud Controller's filesystem
  selector_property_inputs:
  - reference: .properties.system_blobstore.internal
    label: Internal WebDAV (provided by Application Service)

  - reference: .properties.system_blobstore.external
    label: |
      External S3-Compatible File Store (if you want to use a service like S3
      or Ceph)
    property_inputs:
      - reference: .properties.system_blobstore.external.endpoint
        label: URL Endpoint
        description: URL endpoint of your S3-compatible file store

      - reference: .properties.system_blobstore.external.iam_instance_profile_authentication
        label: S3 AWS with Instance Profile
        description: |
          Use instance profile for S3 authentication. This must have been associated with
          your resource config as a VM extension.

      - reference: .properties.system_blobstore.external.access_key
        label: Access Key (required if not using S3 AWS with Instance Profile)

      - reference: .properties.system_blobstore.external.secret_key
        label: Secret Key (required if not using S3 AWS with Instance Profile)

      - reference: .properties.system_blobstore.external.signature_version
        label: S3 Signature Version

      - reference: .properties.system_blobstore.external.region
        label: Region
        description: |
          The AWS Region where the buckets are located, e.g. "us-east-1"
          or "ap-northeast-1".
        placeholder: "us-east-1"

      - reference: .properties.system_blobstore.external.encryption
        label: Server-side Encryption (available for AWS S3 only)

      - reference: .properties.system_blobstore.external.encryption_kms_key_id
        label: KMS Key ID (requires Server-side Encryption to be checked)
        description: |
          The files uploaded to the blobstore will be encrypted using the given KMS key.
          If Server-side Encryption is enabled and a KMS Key ID is not provided, the default AWS key is used.

      - reference: .properties.system_blobstore.external.buildpacks_bucket
        label: Buildpacks Bucket Name
        description: S3 bucket for storing app buildpacks.

      - reference: .properties.system_blobstore.external.droplets_bucket
        label: Droplets Bucket Name
        description: |
          S3 bucket for storing app droplets. Pivotal recommends that you use
          a unique bucket name for droplets, but you can also use the same
          name as above.

      - reference: .properties.system_blobstore.external.packages_bucket
        label: Packages Bucket Name
        description: |
          S3 bucket for storing app packages. Pivotal recommends that you use
          a unique bucket name for packages, but you can also use the same
          name as above.

      - reference: .properties.system_blobstore.external.resources_bucket
        label: Resources Bucket Name
        description: |
          S3 bucket for storing app resources. Pivotal recommends that you
          use a unique bucket name for app resources, but you can also use
          the same name as above.

      - reference: .properties.system_blobstore.external.versioning
        label: Use versioning for backup and restore. (All of the above buckets must have versioning enabled and use the V4 S3 Signature Version).
        description: |
          If versioning is not enabled or supported, you can configure separate buckets below for backups.
          More information at https://docs.pivotal.io/pivotalcf/2-1/customizing/backup-restore/backup-pcf-bbr.html.

      - reference: .properties.system_blobstore.external.backup_region
        label: Backup Region
        description: |
          The AWS Region where the buckets are located, e.g. "us-east-1"
          or "ap-northeast-1".
        placeholder: "us-east-1"

      - reference: .properties.system_blobstore.external.buildpacks_backup_bucket
        label: Backup Buildpacks Bucket Name
        description: S3 bucket for storing app buildpacks.

      - reference: .properties.system_blobstore.external.droplets_backup_bucket
        label: Backup Droplets Bucket Name
        description: |
          S3 bucket for storing app droplets. Pivotal recommends that you use
          a unique bucket name for droplets, but you can also use the same
          name as above.

      - reference: .properties.system_blobstore.external.packages_backup_bucket
        label: Backup Packages Bucket Name
        description: |
          S3 bucket for storing app packages. Pivotal recommends that you use
          a unique bucket name for packages, but you can also use the same
          name as above.

  - reference: .properties.system_blobstore.external_gcs
    label: External Google Cloud Storage with Access Key and Secret Key
    description:
    property_inputs:
      - reference: .properties.system_blobstore.external_gcs.access_key
        label: Access Key

      - reference: .properties.system_blobstore.external_gcs.secret_key
        label: Secret Key

      - reference: .properties.system_blobstore.external_gcs.buildpacks_bucket
        label: Buildpacks Bucket Name
        description: Bucket for storing app buildpacks.

      - reference: .properties.system_blobstore.external_gcs.droplets_bucket
        label: Droplets Bucket Name
        description: |
          Bucket for storing app droplets. Pivotal recommends that you use a
          unique bucket name for droplets, but you can also use the same name
          as above.

      - reference: .properties.system_blobstore.external_gcs.packages_bucket
        label: Packages Bucket Name
        description: |
          Bucket for storing app packages. Pivotal recommends that you use a
          unique bucket name for packages, but you can also use the same name
          as above.

      - reference: .properties.system_blobstore.external_gcs.resources_bucket
        label: Resources Bucket Name
        description: |
          Bucket for storing app resources. Pivotal recommends that you use a
          unique bucket name for app resources, but you can also use the same
          name as above.

  - reference: .properties.system_blobstore.external_gcs_service_account
    label: External Google Cloud Storage with Service Account
    description:
    property_inputs:
      - reference: .properties.system_blobstore.external_gcs_service_account.project_id
        label: GCP Project ID
        description: |
          Your Google Cloud Platform Project ID. The Project ID can be found
          on the Dashboard of the GCP Console.

      - reference: .properties.system_blobstore.external_gcs_service_account.service_account_email
        label: GCP Service Account Email
        description: |
          Your Google Cloud Platform Service Account Email.

      - reference: .properties.system_blobstore.external_gcs_service_account.service_account_json_key
        label: GCP Service Account Key JSON
        description: |
          Your Google Cloud Platform Service Account Key with access to the specified
          project and bucket in JSON format.

      - reference: .properties.system_blobstore.external_gcs_service_account.buildpacks_bucket
        label: Buildpacks Bucket Name
        description: Bucket for storing app buildpacks.

      - reference: .properties.system_blobstore.external_gcs_service_account.droplets_bucket
        label: Droplets Bucket Name
        description: |
          Bucket for storing app droplets. Pivotal recommends that you use a
          unique bucket name for droplets, but you can also use the same name
          as above.

      - reference: .properties.system_blobstore.external_gcs_service_account.packages_bucket
        label: Packages Bucket Name
        description: |
          Bucket for storing app packages. Pivotal recommends that you use a
          unique bucket name for packages, but you can also use the same name
          as above.

      - reference: .properties.system_blobstore.external_gcs_service_account.resources_bucket
        label: Resources Bucket Name
        description: |
          Bucket for storing app resources. Pivotal recommends that you use a
          unique bucket name for app resources, but you can also use the same
          name as above.

  - reference: .properties.system_blobstore.external_azure
    label: External Azure Storage
    description:
    property_inputs:
      - reference: .properties.system_blobstore.external_azure.account_name
        label: Account Name

      - reference: .properties.system_blobstore.external_azure.access_key
        label: Access Key

      - reference: .properties.system_blobstore.external_azure.environment
        label: Environment
        description: |
          This is the canonical name for the Azure Cloud environment where
          your storage resides. The default value is AzureCloud, but other options
          include AzureChinaCloud, AzureUSGovernment, and AzureGermanCloud.

      - reference: .properties.system_blobstore.external_azure.buildpacks_container
        label: Buildpacks Container Name
        description: Container for storing app buildpacks.

      - reference: .properties.system_blobstore.external_azure.droplets_container
        label: Droplets Container Name
        description: |
          Container for storing app droplets. Pivotal recommends that you use
          a unique container name for droplets, but you can also use the same
          name as above.

      - reference: .properties.system_blobstore.external_azure.packages_container
        label: Packages Container Name
        description: |
          Container for storing app packages. Pivotal recommends that you use
          a unique container name for packages, but you can also use the same
          name as above.

      - reference: .properties.system_blobstore.external_azure.resources_container
        label: Resources Container Name
        description: |
          Container for storing app resources. Pivotal recommends that you
          use a unique container name for app resources, but you can also use
          the same name as above.

      - reference: .properties.system_blobstore.external_azure.enable_bbr
        label: |
          Enable backup and restore (Soft deletes must be enabled for
          all storage containers listed above).
