---
name: rep_windows
release: diego
manifest: |
  diego:
    executor:
      ca_certs_for_downloads: (( $ops_manager.ca_certificate ))
      instance_identity_ca_cert: ((( /cf/diego-instance-identity-intermediate-ca.certificate )))
      instance_identity_key: ((( /cf/diego-instance-identity-intermediate-ca.private_key )))
    rep:
      enable_legacy_api_endpoints: false
      ca_cert: (( $ops_manager.ca_certificate ))
      server_cert: (( .properties.rep_server_cert.cert_pem ))
      server_key: (( .properties.rep_server_cert.private_key_pem ))
      use_azure_fault_domains: true
      open_bindmounts_acl: true
      bbs:
        ca_cert: (( $ops_manager.ca_certificate ))
        client_cert: (( .properties.bbs_client_cert.cert_pem ))
        client_key: (( .properties.bbs_client_cert.private_key_pem ))
      consul:
        require_tls: true
        ca_cert: (( $ops_manager.ca_certificate ))
        client_cert: (( windows_consul_agent_cert.cert_pem ))
        client_key: (( windows_consul_agent_cert.private_key_pem ))
      locket:
        api_location: "locket.service.cf.internal:8891"
      preloaded_rootfses:
      - windows2016:/var/vcap/packages/windows2016fs/rootfs
      placement_tags: (( placement_tags.parsed_strings ))
      trusted_certs: |
        ((( /cf/diego-instance-identity-root-ca.certificate )))
        (( $ops_manager.ca_certificate ))
        (( $ops_manager.trusted_certificates ))
        (( ..cf.properties.networking_poe_ssl_cert.cert_pem ))
  enable_declarative_healthcheck: true
  loggregator:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_client_cert.cert_pem ))
    key: (( .properties.loggregator_client_cert.private_key_pem ))
    tls:
      ca_cert: (( $ops_manager.ca_certificate ))
      metron:
        cert: (( .properties.metron_tls_cert.cert_pem ))
        key: (( .properties.metron_tls_cert.private_key_pem ))
    use_v2_api: true
  tls:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.rep_server_cert.cert_pem ))
    key: (( .properties.rep_server_cert.private_key_pem ))
