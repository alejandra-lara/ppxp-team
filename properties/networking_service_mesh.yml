---
- name: istio
  type: selector
  configurable: true
  default: disable
  option_templates:
    - name: disable
      select_value: disable
      named_manifests:
      - name: capi_enabled
        manifest: "false"
      - name: ingress_istio_domain
        manifest: |
          []
    - name: enable
      select_value: enable
      named_manifests:
      - name: capi_enabled
        manifest: "true"
      - name: ingress_istio_domain
        manifest: |
          '(( .properties.istio_domain.value ? "" : "mesh."))(( .properties.istio_domain.value ? .properties.istio_domain.value : .cloud_controller.apps_domain.value ))'

- name: istio_domain
  type: string
  configurable: true
  optional: true

- name: istio_frontend_tls_keypairs
  type: collection
  configurable: true
  optional: true
  property_blueprints:
  - name: name
    type: string
    configurable: true
  - name: certificate
    type: rsa_cert_credentials
    configurable: true
  named_manifests:
  - name: istio_certificates_and_private_keys
    manifest: |
      cert_chain: (( current_record.certificate.cert_pem ))
      private_key: (( current_record.certificate.private_key_pem ))
