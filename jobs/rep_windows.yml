---
name: rep_windows
release: diego
manifest: |
  containers:
    proxy: (( .properties.route_integrity.selected_option.parsed_manifest(proxy) ))
    trusted_ca_certificates:
      - ((( diego-instance-identity-intermediate-ca-2-7.ca )))
      - (( $ops_manager.ca_certificate ))
      - (( $ops_manager.trusted_certificates ))
      - ((( /services/intermediate_tls_ca.ca )))
  declarative_healthcheck_path: /var/vcap/packages/healthcheck_windows/internal
  diego:
    executor:
      disk_capacity_mb: (( .windows_diego_cell.executor_disk_capacity.value ))
      instance_identity_ca_cert: ((( diego-instance-identity-intermediate-ca-2-7.certificate )))
      instance_identity_key: ((( diego-instance-identity-intermediate-ca-2-7.private_key )))
      memory_capacity_mb: (( .windows_diego_cell.executor_memory_capacity.value ))
      max_log_lines_per_second: (( .properties.app_log_rate_limiting.selected_option.parsed_manifest(app_log_rate_limiting_properties) ))
    rep:
      use_azure_fault_domains: true
      open_bindmounts_acl: true
      locket:
        api_location: "locket.service.cf.internal:8891"
      preloaded_rootfses:
      - windows2016:oci:///C:/var/vcap/packages/windows2019fs
      - windows:oci:///C:/var/vcap/packages/windows2019fs
      placement_tags: (( placement_tags.parsed_strings ))
  enable_consul_service_registration: false
  enable_declarative_healthcheck: true
  logging:
    format:
      timestamp: (( ..cf.properties.logging_timestamp_format.selected_option.parsed_manifest(rfc3339_or_unix_epoch) ))
  loggregator:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_client_cert.cert_pem ))
    key: (( .properties.loggregator_client_cert.private_key_pem ))
    use_v2_api: true
  tls:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.rep_server_cert_v2.cert_pem ))
    key: (( .properties.rep_server_cert_v2.private_key_pem ))
