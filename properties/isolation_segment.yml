---
- name: compute_isolation
  type: selector
  configurable: true
  default: enabled
  option_templates:
  - name: disabled
    select_value: disabled
    named_manifests:
    - name: for_rep
      manifest: |
        use_azure_fault_domains: true
        preloaded_rootfses:
          - "cflinuxfs3:/var/vcap/packages/cflinuxfs3/rootfs.tar"
        advertise_preference_for_instance_address: (( ..cf.properties.container_networking_interface_plugin.selected_option.parsed_manifest(use_container_address) ))
    - name: for_loggregator_agent_tags
      manifest: |
        product: $( variable "label" )
        system_domain: "(( ..cf.cloud_controller.system_domain.value ))"
    - name: for_routing_table_sharding_mode
      manifest: |
        []
  - name: enabled
    select_value: enabled
    property_blueprints:
    - name: isolation_segment_name
      type: string
      configurable: true
      optional: false
    named_manifests:
    - name: for_rep
      manifest: |
        placement_tags: [(( .properties.compute_isolation.enabled.isolation_segment_name.value ))]
        use_azure_fault_domains: true
        preloaded_rootfses:
          - "cflinuxfs3:/var/vcap/packages/cflinuxfs3/rootfs.tar"
        advertise_preference_for_instance_address: (( ..cf.properties.container_networking_interface_plugin.selected_option.parsed_manifest(use_container_address) ))
    - name: for_loggregator_agent_tags
      manifest: |
        placement_tag: (( .properties.compute_isolation.enabled.isolation_segment_name.value ))
        product: $( variable "label" )
        system_domain: "(( ..cf.cloud_controller.system_domain.value ))"
    - name: for_routing_table_sharding_mode
      manifest: |
        ['(( .properties.compute_isolation.enabled.isolation_segment_name.value ))']
