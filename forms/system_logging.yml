---
name: system_logging
label: System Logging
description: |
  Optionally configure rsyslog to forward platform component logs
  to an external service.
  If you do not fill these fields,
  platform logs will not be forwarded
  but will remain available on the component VMs
  and for download via Ops Manager.

property_inputs:
- reference: .properties.system_logging
  label: |
    Do you want to configure syslog for system components?

  selector_property_inputs:
  - reference: .properties.system_logging.disabled
    label: "No"

  - reference: .properties.system_logging.enabled
    label: "Yes"
    property_inputs:
    - reference: .properties.system_logging.enabled.host
      label: Address
      description: |
        The aggregator must be reachable from the Isolation Segment network,
        accept TCP, UDP or RELP connections, and use the RELP protocol (e.g.
        rsyslogd). You can also configure this with an IP address.

    - reference: .properties.system_logging.enabled.port
      label: Port
      description: |
        The typical syslogd port is 514. Ensure syslogd is listening on
        external interfaces.

    - reference: .properties.system_logging.enabled.protocol
      label: Transport Protocol
      description: |
        Select the transport protocol for forwarding logs.

    - reference: .properties.system_logging.enabled.tls_enabled
      label: Enable TLS
      description: |
        When checked both Permitted Peer and TLS CA Certificate are required.

    - reference: .properties.system_logging.enabled.tls_permitted_peer
      label: Permitted Peer
      description: |
        Either the accepted fingerprint (SHA1) or name of remote peer, e.g.
        *.example.com

    - reference: .properties.system_logging.enabled.tls_ca_cert
      label: TLS CA Certificate
      description: |
        This certificate will ensure that logs get securely transported to
        the syslog destination

    - reference: .properties.system_logging.enabled.use_tcp_for_file_forwarding_local_transport
      label: Use TCP for file forwarding local transport
      description: |
        Workaround to avoid truncation of very long
        (> 1024 bytes)
        log lines.
        May negatively impact performance.

    - reference: .properties.syslog_drop_debug
      label: Don't Forward Debug Logs
      description: |
        Some components produce voluminous debug logs.
        This option prevents them from being forwarded.
        They will still be written to local disk.

    - reference: .properties.system_logging.enabled.syslog_rule
      label: Custom rsyslog Configuration
      description: |
        Accepts configuration for rsyslog
        in the rainerscript syntax.
        For example,
        'if ($app-name startswith "exampleComponent") then stop'
        can be used to drop all traffic
        from a particular component.
        Entered configuration will be applied
        prior to the forwarding rule.
