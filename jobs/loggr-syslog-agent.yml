---
name: loggr-syslog-agent
release: loggregator-agent
consumes: |
  binding_cache:
    from:  binding_cache
    deployment: (( ..cf.deployment_name ))
  cloud_controller:
    from: cloud_controller
    deployment: (( ..cf.deployment_name ))

manifest: |
  port: 3460
  tls:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.loggregator_agent_tls_cert.cert_pem ))
    key: (( .properties.loggregator_agent_tls_cert.private_key_pem ))
  metrics:
    ca_cert: (( $ops_manager.ca_certificate ))
    cert: (( .properties.syslog_agent_metrics_tls.cert_pem ))
    key: (( .properties.syslog_agent_metrics_tls.private_key_pem ))
    server_name: syslog_agent_metrics
  cache:
    tls:
      ca_cert: (( $ops_manager.ca_certificate ))
      cert: (( .properties.scheduler_binding_cache_tls.cert_pem ))
      key: (( .properties.scheduler_binding_cache_tls.private_key_pem ))
      cn: binding-cache
  aggregate_drains: "syslog-tls://doppler.service.cf.internal:6067,(( ..cf.properties.syslog_agent_aggregate_drains.value ))"