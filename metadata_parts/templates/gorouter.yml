---
name: gorouter
release: routing
manifest: |
  uaa:
    clients:
      gorouter:
        secret: (( .uaa.gorouter_client_credentials.password ))
    ca_cert: (( $ops_manager.ca_certificate ))
    ssl:
      port: 8443
  request_timeout_in_seconds: (( request_timeout_in_seconds.value ))
  router:
    ca_certs: (( .properties.routing_custom_ca_certificates.value ))
    forwarded_client_cert: (( .properties.router_forward_client_cert.value ))
    max_idle_connections: (( max_idle_connections.value ))
    route_services_secret: (( .properties.route_services.selected_option.parsed_manifest(secret) ))
    ssl_skip_validation: (( .ha_proxy.skip_cert_verify.value ))
    drain_wait: (( .router.drain_wait.value ))
    tracing:
      enable_zipkin: (( enable_zipkin.value ))
    secure_cookies: (( .router.disable_insecure_cookies.value ))
    load_balancer_healthy_threshold: (( .router.lb_healthy_threshold.value ))
    extra_headers_to_log: (( .router.extra_headers_to_log.parsed_strings ))
    routing_table_sharding_mode: '(( enable_isolated_routing.value ? "shared-and-segments" : "all" ))'
    status:
      user: ((( router-status-credentials.username )))
      password: ((( router-status-credentials.password )))
    cipher_suites: (( .properties.gorouter_ssl_ciphers.value ))
    disable_http: (( .properties.routing_disable_http.value ))
    enable_ssl: true
    tls_pem: (( .properties.networking_poe_ssl_certs.parsed_manifest(routing_certificates) ))
    min_tls_version: (( .properties.routing_minimum_tls_version.selected_option.parsed_manifest(min_tls_version) ))
    backends:
      max_conns: (( .properties.router_backend_max_conn.value ))
    frontend_idle_timeout: (( .router.frontend_idle_timeout.value ))
  routing_api:
    enabled: true
