---
name: mysql
release: cf-mysql
provides: |
  mysql: {as: cf-mysql-direct-mysql}
consumes: |
  mysql: {from: cf-mysql-direct-mysql}

manifest: |
  cf_mysql_enabled: (( .properties.system_database.selected_option.parsed_manifest(enable_internal_mysql) ))
  cf_mysql:
    mysql:
      port: $( variable "mysql_port" )
      cli_history: (( .mysql.cli_history.value ))
      interrupt_notify_cmd: "/var/vcap/jobs/send-email/bin/run"
      innodb_buffer_pool_size: 2147483648
      innodb_strict_mode: true
      max_open_files: 1048576
      startup_timeout: 120
      cluster_probe_timeout: (( .mysql.cluster_probe_timeout.value ))
      max_connections: (( .mysql.max_connections.value ))
      cluster_health:
        password: ((( mysql-cluster-health-credentials.password )))
      disable_auto_sst: (( .mysql.prevent_node_auto_rejoin.value ))
      remote_admin_access: (( .mysql.remote_admin_access.value ))
      seeded_databases:
      - name: (( .properties.app_usage_service_database_name.value ))
        username: ((( app-usage-db-credentials.username )))
        password: ((( app-usage-db-credentials.password )))
      - name: (( .properties.autoscale_database_name.value ))
        username: ((( autoscale-db-credentials.username )))
        password: ((( autoscale-db-credentials.password )))
      - name: (( .properties.ccdb_database_name.value ))
        username: ((( cc-db-credentials.username )))
        password: ((( cc-db-credentials.password )))
      - name: (( .properties.credhub_database_name.value ))
        username: ((( credhub-db-credentials.username )))
        password: ((( credhub-db-credentials.password )))
      - name: (( .properties.diego_database_name.value ))
        username: ((( diego-db-credentials.username )))
        password: ((( diego-db-credentials.password )))
      - name: (( .properties.locket_database_name.value ))
        username: ((( locket-db-credentials.username )))
        password: ((( locket-db-credentials.password )))
      - name: (( .properties.networkpolicyserver_database_name.value ))
        username: ((( network-policy-server-db-credentials.username )))
        password: ((( network-policy-server-db-credentials.password )))
      - name: (( .properties.nfsvolume_database_name.value ))
        username: ((( nfs-volume-db-credentials.username )))
        password: ((( nfs-volume-db-credentials.password )))
      - name: (( .properties.notifications_database_name.value ))
        username: ((( notifications-db-credentials.username )))
        password: ((( notifications-db-credentials.password )))
      - name: (( .properties.routing_database_name.value ))
        username: ((( routing-db-credentials.username )))
        password: ((( routing-db-credentials.password )))
      - name: (( .properties.silk_database_name.value ))
        username: ((( silk-db-credentials.username )))
        password: ((( silk-db-credentials.password )))
      - name: (( .properties.uaa_database_name.value ))
        username: ((( uaa-db-credentials.username )))
        password: ((( uaa-db-credentials.password )))
      - name: monitor
        username: ((( mysql-monitor-db-credentials.username )))
        password: ((( mysql-monitor-db-credentials.password )))
      - name: metrics_db
        username: ((( mysql-metrics-db-credentials.username )))
        password: ((( mysql-metrics-db-credentials.password )))
      server_audit_excluded_users:
      - ((( mysql-metrics-db-credentials.username )))
      - ((( mysql-monitor-db-credentials.username )))
      admin_password: ((( mysql-admin-credentials.password )))
      galera_healthcheck:
        db_password: ((( mysql-galera-sidecar-credentials.password )))
        endpoint_username: ((( mysql-bootstrap-db-credentials.username )))
        endpoint_password: ((( mysql-bootstrap-db-credentials.password )))
      server_audit_events: (( .properties.mysql_activity_logging.selected_option.parsed_manifest(mysql_audit_events) ))
