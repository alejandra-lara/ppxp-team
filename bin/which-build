#!/bin/bash

set -eu -o pipefail

tile_dir="$( cd "$( dirname "$0" )/.." && pwd )"

if [ "$#" != 1 ]; then
  >&2 echo "Incorrect usage. Expected usage: $0 <commit-sha>"
  exit 1
fi

commit="$1"

pushd "${tile_dir}" > /dev/null
  previous_version_bump_sha="$(git rev-list "${commit}" --max-count 1 -- version)"
  build_number="$(git show "${previous_version_bump_sha}:version")"
  echo "The first tile to contain sha '${commit}' was ${build_number}"
popd > /dev/null
