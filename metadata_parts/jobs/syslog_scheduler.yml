---
name: syslog_scheduler
label: Syslog Scheduler
resource_label: Syslog Scheduler
description: This component handles communication with the Cloud Controller to receive new bindings. It should not be scaled beyond a single instance.
templates:
  - name: consul_agent
    release: consul
    consumes: |
      consul: nil
      consul_common: {from: consul_common_link}
      consul_client: {from: consul_client_link}
      consul_server: nil
  - name: scheduler
    release: scalablesyslog

resource_definitions:
  - name: ram
    type: integer
    label: RAM
    configurable: true
    default: 1_024
    constraints:
      min: 1_024

  - name: ephemeral_disk
    type: integer
    label: Ephemeral Disk
    configurable: true
    default: 2_048
    constraints:
      min: 2_048

  - name: persistent_disk
    type: integer
    label: Persistent Disk
    configurable: false
    default: 0

  - name: cpu
    type: integer
    label: CPU
    configurable: true
    default: 1
    constraints:
      min: 1

static_ip: 0
dynamic_ip: 1
max_in_flight: 1
single_az_only: false

instance_definition:
  name: instances
  type: integer
  label: Instances
  default: 3
  configurable: true
  constraints:
    min: 1

property_blueprints:
  - name: scheduler_api_tls
    type: rsa_cert_credentials
    configurable: false
    default:
      domains: ["cloud-controller-ng.service.cf.internal"]

  - name: scheduler_client_tls
    type: rsa_cert_credentials
    configurable: false
    default:
      domains: ["ss-adapter"]

manifest: |
  scalablesyslog:
    scheduler:
      require_opt_in: true
      api:
        url: https://cloud-controller-ng.service.cf.internal:9023
      tls:
        client:
          ca: (( $ops_manager.ca_certificate ))
          cert: (( scheduler_client_tls.cert_pem ))
          key: (( scheduler_client_tls.private_key_pem ))
          adapter_cn: ss-adapter
        api:
          ca: (( $ops_manager.ca_certificate ))
          cert: (( scheduler_api_tls.cert_pem ))
          key: (( scheduler_api_tls.private_key_pem ))
          cn: cloud-controller-ng.service.cf.internal
