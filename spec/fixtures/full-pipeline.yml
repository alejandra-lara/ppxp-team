---
resources:
- name: some-resource
  type: git
- name: another-resource
  type: s3
  source:
    some_key: just-a-key
jobs:
- name: a-generic-job
  plan:
  - get: a-get-task
    resource: some-resource
  - task: a-generic-task
- name: promote-ert
  plan:
  - get: p-runtime
    resource: p-runtime-prime
    trigger: true
    passed:
    - release-environment-aws-clean
    - release-environment-vsphere-clean
    - release-environment-internetless
    - release-environment-aws-upgrade
    - release-environment-vsphere-upgrade
    - release-environment-vcloud-upgrade
  - get: ert-product
    passed:
    - build-runtime
  - put: ert-product-promoted
    params:
      from: ert-product/ert.pivotal
- name: destroy-environment-aws-clean
  plan:
  - get: environment
    resource: environment-aws
    trigger: true
    passed:
    - claim-environment-aws-clean
  - task: destroy
    tags:
    - aws
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-aws-clean
  plan:
  - task: some-task
- name: configure-microbosh-aws-clean
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-aws-clean
  - get: environment
    resource: environment-aws-clean
    passed:
    - deploy-ops-manager-aws-clean
- name: configure-ert-aws-clean
  plan:
  - task: some-task
    tags:
    - aws
    resource: environment-aws
  - task: some-aws-task
    tags: aws
  - task: some-experimental-aws-task
    tags: aws
- name: another-job-aws-clean
  plan:
  - task: another-task
    tags:
    - aws
    resource: environment-aws
- name: destroy-environment-final-aws-clean
  plan:
  - get: environment
    resource: environment-aws
    trigger: true
    passed:
    - claim-environment-aws-clean
  - task: destroy
    tags:
    - aws
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-aws-clean
  plan:
  - get: environment
    resource: environment-aws
    trigger: true
    passed:
    - destroy-environment-aws-clean
  - task: release
    tags:
    - aws
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-openstack-clean
  plan:
  - get: environment
    resource: environment-openstack
    trigger: true
    passed:
    - claim-environment-openstack-clean
  - task: destroy
    tags:
    - openstack
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-openstack-clean
  plan:
  - task: some-task
- name: configure-microbosh-openstack-clean
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-openstack-clean
  - get: environment
    resource: environment-openstack-clean
    passed:
    - deploy-ops-manager-openstack-clean
- name: configure-ert-openstack-clean
  plan:
  - task: some-task
    tags:
    - openstack
    resource: environment-openstack
- name: another-job-openstack-clean
  plan:
  - task: another-task
    tags:
    - openstack
    resource: environment-openstack
- name: destroy-environment-final-openstack-clean
  plan:
  - get: environment
    resource: environment-openstack
    trigger: true
    passed:
    - claim-environment-openstack-clean
  - task: destroy
    tags:
    - openstack
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-openstack-clean
  plan:
  - get: environment
    resource: environment-openstack
    trigger: true
    passed:
    - destroy-environment-openstack-clean
  - task: release
    tags:
    - openstack
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-vsphere-clean
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - claim-environment-vsphere-clean
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-vsphere-clean
  plan:
  - task: some-task
- name: configure-microbosh-vsphere-clean
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-vsphere-clean
  - get: environment
    resource: environment-vsphere-clean
    passed:
    - deploy-ops-manager-vsphere-clean
- name: configure-ert-vsphere-clean
  plan:
  - task: some-task
    tags:
    - vsphere
    resource: environment-vsphere
- name: another-job-vsphere-clean
  plan:
  - task: another-task
    tags:
    - vsphere
    resource: environment-vsphere
- name: destroy-environment-final-vsphere-clean
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - claim-environment-vsphere-clean
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-vsphere-clean
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - destroy-environment-vsphere-clean
  - task: release
    tags:
    - vsphere
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-internetless
  plan:
  - get: environment
    resource: environment-internetless
    trigger: true
    passed:
    - claim-environment-internetless
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-internetless
  plan:
  - task: some-task
- name: verify-internetless
  plan:
  - task: verify
- name: configure-microbosh-internetless
  plan:
  - get: p-runtime
    passed:
    - verify-internetless
  - get: environment
    resource: environment-internetless
    passed:
    - verify-internetless
- name: configure-ert-internetless
  plan:
  - task: some-task
    tags:
    - vsphere
    resource: environment-internetless
- name: another-job-internetless
  plan:
  - task: another-task
    tags:
    - vsphere
    resource: environment-internetless
- name: destroy-environment-final-internetless
  plan:
  - get: environment
    resource: environment-internetless
    trigger: true
    passed:
    - claim-environment-internetless
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-internetless
  plan:
  - get: environment
    resource: environment-internetless
    trigger: true
    passed:
    - destroy-environment-internetless
  - task: release
    tags:
    - vsphere
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-aws-upgrade
  plan:
  - get: environment
    resource: environment-aws-east
    trigger: true
    passed:
    - claim-environment-aws-upgrade
  - task: destroy
    tags:
    - aws
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-aws-upgrade
  plan:
  - task: some-task
- name: configure-microbosh-aws-upgrade
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-aws-upgrade
  - get: environment
    resource: environment-aws-upgrade
    passed:
    - deploy-ops-manager-aws-upgrade
- name: configure-ert-aws-upgrade
  plan:
  - task: some-task
    tags:
    - aws
    resource: environment-aws-east
  - task: some-aws-upgrade-task
    tags: aws
- name: another-job-aws-upgrade
  plan:
  - task: another-task
    tags:
    - aws
    resource: environment-aws-east
- name: destroy-environment-final-aws-upgrade
  plan:
  - get: environment
    resource: environment-aws-east
    trigger: true
    passed:
    - claim-environment-aws-upgrade
  - task: destroy
    tags:
    - aws
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-aws-upgrade
  plan:
  - get: environment
    resource: environment-aws-east
    trigger: true
    passed:
    - destroy-environment-aws-upgrade
  - task: release
    tags:
    - aws
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-vsphere-upgrade
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - claim-environment-vsphere-upgrade
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-vsphere-upgrade
  plan:
  - task: some-task
- name: configure-microbosh-vsphere-upgrade
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-vsphere-upgrade
  - get: environment
    resource: environment-vsphere-upgrade
    passed:
    - deploy-ops-manager-vsphere-upgrade
- name: configure-ert-vsphere-upgrade
  plan:
  - task: some-task
    tags:
    - vsphere
    resource: environment-vsphere
- name: another-job-vsphere-upgrade
  plan:
  - task: another-task
    tags:
    - vsphere
    resource: environment-vsphere
- name: destroy-environment-final-vsphere-upgrade
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - claim-environment-vsphere-upgrade
  - task: destroy
    tags:
    - vsphere
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-vsphere-upgrade
  plan:
  - get: environment
    resource: environment-vsphere
    trigger: true
    passed:
    - destroy-environment-vsphere-upgrade
  - task: release
    tags:
    - vsphere
    file: p-runtime/ci/jobs/release-environment.yml
- name: destroy-environment-vcloud-upgrade
  plan:
  - get: environment
    resource: environment-vcloud
    trigger: true
    passed:
    - claim-environment-vcloud-upgrade
  - &1
    task: some-vcloud-task
    tags: vcloud
  - &2
    task: another-vcloud-task
    tags: vcloud
  - task: destroy
    tags:
    - vcloud
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: deploy-ops-manager-vcloud-upgrade
  plan:
  - task: some-task
- name: configure-microbosh-vcloud-upgrade
  plan:
  - get: p-runtime
    passed:
    - deploy-ops-manager-vcloud-upgrade
  - get: environment
    resource: environment-vcloud-upgrade
    passed:
    - deploy-ops-manager-vcloud-upgrade
- name: configure-ert-vcloud-upgrade
  plan:
  - task: some-task
    tags:
    - vcloud
    resource: environment-vcloud
- name: another-job-vcloud-upgrade
  plan:
  - task: another-task
    tags:
    - vcloud
    resource: environment-vcloud
- name: destroy-environment-final-vcloud-upgrade
  plan:
  - get: environment
    resource: environment-vcloud
    trigger: true
    passed:
    - claim-environment-vcloud-upgrade
  - *1
  - *2
  - task: destroy
    tags:
    - vcloud
    file: p-runtime/ci/jobs/destroy-environment.yml
- name: release-environment-vcloud-upgrade
  plan:
  - get: environment
    resource: environment-vcloud
    trigger: true
    passed:
    - destroy-environment-vcloud-upgrade
  - task: release
    tags:
    - vcloud
    file: p-runtime/ci/jobs/release-environment.yml
groups:
- name: aws-clean
  stuff: foo
- name: openstack-clean
  stuff: foo
- name: vsphere-clean
  stuff: foo
- name: vsphere-internetless
  stuff: foo
- name: aws-upgrade
  stuff: foo
- name: vsphere-upgrade
  stuff: foo
- name: vcloud-upgrade
  stuff: foo
- name: common
  stuff: foo
